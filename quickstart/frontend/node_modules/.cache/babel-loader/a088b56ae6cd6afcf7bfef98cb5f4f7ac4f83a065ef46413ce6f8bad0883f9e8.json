{"ast":null,"code":"import{useEffect,useState,useCallback}from\"react\";import{apiGet}from\"../api/client\";import{walletManager}from\"../wallet\";export function useHoldings(params){const{partyId,walletType}=params;const[holdings,setHoldings]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[loopRetry,setLoopRetry]=useState(0);const load=useCallback(async()=>{if(!partyId){setHoldings([]);setError(null);setLoading(false);return;}setLoading(true);setError(null);try{// Loop path: use SDK provider to fetch holdings directly.\nif(walletType===\"loop\"){const provider=walletManager.getLoopProvider();if(!provider){// Retry a few times to give the SDK a chance to rehydrate silently.\nif(loopRetry<3){setLoopRetry(r=>r+1);setTimeout(()=>load(),500);}setLoading(false);return;}if(provider!==null&&provider!==void 0&&provider.getHolding){const loopHoldings=await provider.getHolding();const normalized=Array.isArray(loopHoldings)?loopHoldings.map(normalizeLoopHolding).filter(Boolean):[];setHoldings(normalized);setLoading(false);return;}}// Default path: backend API.\nconst data=await apiGet(\"/api/holdings/\".concat(encodeURIComponent(partyId)));const normalized=Array.isArray(data)?data.map(normalizeHolding).filter(Boolean):[];setHoldings(normalized);}catch(err){console.warn(\"Failed to load holdings for\",partyId,err);setHoldings([]);setError(err instanceof Error?err:new Error(\"Failed to load holdings\"));}finally{setLoading(false);}},[partyId,walletType,loopRetry]);useEffect(()=>{load();},[load]);return{holdings,loading,error};}function normalizeHolding(raw){var _metadata,_ref,_instrument$instrumen,_instrument$instrumen2,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9,_ref0,_instrument$instrumen3,_instrument$instrumen4,_ref1,_ref10,_ref11,_name,_metadata2,_ref12,_ref13,_ref14,_amount,_ref15,_decimals;const instrument=raw===null||raw===void 0?void 0:raw.instrument;const metadata=(_metadata=raw===null||raw===void 0?void 0:raw.metadata)!==null&&_metadata!==void 0?_metadata:instrument===null||instrument===void 0?void 0:instrument.metadata;const rawInstrumentId=(_ref=(_instrument$instrumen=instrument===null||instrument===void 0?void 0:(_instrument$instrumen2=instrument.instrumentId)===null||_instrument$instrumen2===void 0?void 0:_instrument$instrumen2.id)!==null&&_instrument$instrumen!==void 0?_instrument$instrumen:raw===null||raw===void 0?void 0:raw.instrumentId)!==null&&_ref!==void 0?_ref:null;const symbolCandidate=(_ref2=(_ref3=(_ref4=(_ref5=(_ref6=(_ref7=(_ref8=(_ref9=(_ref0=(_instrument$instrumen3=instrument===null||instrument===void 0?void 0:(_instrument$instrumen4=instrument.instrumentId)===null||_instrument$instrumen4===void 0?void 0:_instrument$instrumen4.id)!==null&&_instrument$instrumen3!==void 0?_instrument$instrumen3:instrument===null||instrument===void 0?void 0:instrument.symbol)!==null&&_ref0!==void 0?_ref0:instrument===null||instrument===void 0?void 0:instrument.assetCode)!==null&&_ref9!==void 0?_ref9:metadata===null||metadata===void 0?void 0:metadata.symbol)!==null&&_ref8!==void 0?_ref8:metadata===null||metadata===void 0?void 0:metadata.code)!==null&&_ref7!==void 0?_ref7:raw===null||raw===void 0?void 0:raw.symbol)!==null&&_ref6!==void 0?_ref6:raw===null||raw===void 0?void 0:raw.token)!==null&&_ref5!==void 0?_ref5:raw===null||raw===void 0?void 0:raw.assetCode)!==null&&_ref4!==void 0?_ref4:raw===null||raw===void 0?void 0:raw.currencyCode)!==null&&_ref3!==void 0?_ref3:rawInstrumentId)!==null&&_ref2!==void 0?_ref2:\"UNKNOWN\";let symbol=String(symbolCandidate!==null&&symbolCandidate!==void 0?symbolCandidate:\"UNKNOWN\").toUpperCase();let displayName=(_ref1=(_ref10=(_ref11=(_name=raw===null||raw===void 0?void 0:raw.name)!==null&&_name!==void 0?_name:raw===null||raw===void 0?void 0:(_metadata2=raw.metadata)===null||_metadata2===void 0?void 0:_metadata2.name)!==null&&_ref11!==void 0?_ref11:metadata===null||metadata===void 0?void 0:metadata.name)!==null&&_ref10!==void 0?_ref10:instrument===null||instrument===void 0?void 0:instrument.name)!==null&&_ref1!==void 0?_ref1:symbol===\"CC\"?\"Canton Coin\":undefined;if(rawInstrumentId===\"Amulet\"||symbol===\"AMULET\"){symbol=\"CC\";displayName=\"Canton Coin\";}const quantityCandidate=(_ref12=(_ref13=(_ref14=(_amount=raw===null||raw===void 0?void 0:raw.amount)!==null&&_amount!==void 0?_amount:raw===null||raw===void 0?void 0:raw.balance)!==null&&_ref14!==void 0?_ref14:raw===null||raw===void 0?void 0:raw.holdingAmount)!==null&&_ref13!==void 0?_ref13:raw===null||raw===void 0?void 0:raw.quantity)!==null&&_ref12!==void 0?_ref12:\"0\";const quantity=typeof quantityCandidate===\"string\"?quantityCandidate:String(quantityCandidate!==null&&quantityCandidate!==void 0?quantityCandidate:\"0\");const decimalsCandidate=(_ref15=(_decimals=raw===null||raw===void 0?void 0:raw.decimals)!==null&&_decimals!==void 0?_decimals:raw===null||raw===void 0?void 0:raw.precision)!==null&&_ref15!==void 0?_ref15:10;const decimals=typeof decimalsCandidate===\"number\"&&Number.isFinite(decimalsCandidate)?decimalsCandidate:parseInt(String(decimalsCandidate),10)||10;return{symbol,quantity,decimals,displayName};}function normalizeLoopHolding(raw){var _ref16,_instrument_id,_ref17,_ref18,_ref19,_ref20,_instrument$id,_instrument$instrumen5,_ref21,_name2,_ref22,_ref23,_amount2,_ref24,_decimals2;const instrument=(_ref16=(_instrument_id=raw===null||raw===void 0?void 0:raw.instrument_id)!==null&&_instrument_id!==void 0?_instrument_id:raw===null||raw===void 0?void 0:raw.instrumentId)!==null&&_ref16!==void 0?_ref16:raw===null||raw===void 0?void 0:raw.instrument;const instrumentId=(_ref17=(_ref18=(_ref19=(_ref20=(_instrument$id=instrument===null||instrument===void 0?void 0:instrument.id)!==null&&_instrument$id!==void 0?_instrument$id:instrument===null||instrument===void 0?void 0:(_instrument$instrumen5=instrument.instrumentId)===null||_instrument$instrumen5===void 0?void 0:_instrument$instrumen5.id)!==null&&_ref20!==void 0?_ref20:instrument===null||instrument===void 0?void 0:instrument.assetCode)!==null&&_ref19!==void 0?_ref19:instrument===null||instrument===void 0?void 0:instrument.symbol)!==null&&_ref18!==void 0?_ref18:instrument===null||instrument===void 0?void 0:instrument.code)!==null&&_ref17!==void 0?_ref17:\"UNKNOWN\";let symbol=String(instrumentId!==null&&instrumentId!==void 0?instrumentId:\"UNKNOWN\").toUpperCase();let displayName=(_ref21=(_name2=raw===null||raw===void 0?void 0:raw.name)!==null&&_name2!==void 0?_name2:instrument===null||instrument===void 0?void 0:instrument.name)!==null&&_ref21!==void 0?_ref21:symbol===\"CC\"?\"Canton Coin\":undefined;if(instrumentId===\"Amulet\"||symbol===\"AMULET\"){symbol=\"CC\";displayName=\"Canton Coin\";}if(instrumentId===\"CBTC\"||symbol===\"CBTC\"){symbol=\"CBTC\";}const quantityCandidate=(_ref22=(_ref23=(_amount2=raw===null||raw===void 0?void 0:raw.amount)!==null&&_amount2!==void 0?_amount2:raw===null||raw===void 0?void 0:raw.quantity)!==null&&_ref23!==void 0?_ref23:raw===null||raw===void 0?void 0:raw.balance)!==null&&_ref22!==void 0?_ref22:\"0\";const quantity=typeof quantityCandidate===\"string\"?quantityCandidate:String(quantityCandidate!==null&&quantityCandidate!==void 0?quantityCandidate:\"0\");const decimalsCandidate=(_ref24=(_decimals2=raw===null||raw===void 0?void 0:raw.decimals)!==null&&_decimals2!==void 0?_decimals2:raw===null||raw===void 0?void 0:raw.precision)!==null&&_ref24!==void 0?_ref24:10;const decimals=typeof decimalsCandidate===\"number\"&&Number.isFinite(decimalsCandidate)?decimalsCandidate:parseInt(String(decimalsCandidate),10)||10;return{symbol,quantity,decimals,displayName};}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}