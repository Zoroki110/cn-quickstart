{"ast":null,"code":"const DEFAULT_MAX_WAIT_MS=15000;const DEFAULT_INTERVAL_MS=1000;export function balancesKeyFromMap(balances){if(!balances)return'';const keys=Object.keys(balances).sort();return keys.map(key=>{var _balances$key$amount,_balances$key,_balances$key$decimal,_balances$key2;return\"\".concat(key,\":\").concat((_balances$key$amount=(_balances$key=balances[key])===null||_balances$key===void 0?void 0:_balances$key.amount)!==null&&_balances$key$amount!==void 0?_balances$key$amount:'',\":\").concat((_balances$key$decimal=(_balances$key2=balances[key])===null||_balances$key2===void 0?void 0:_balances$key2.decimals)!==null&&_balances$key$decimal!==void 0?_balances$key$decimal:'');}).join('|');}export function poolKeyFromPools(pools,poolCid){if(!pools||pools.length===0)return'';const pool=poolCid?pools.find(p=>p.contractId===poolCid||p.poolId===poolCid):null;const target=pool!==null&&pool!==void 0?pool:pools[0];if(!target)return'';return\"\".concat(target.contractId||target.poolId,\":\").concat(target.reserveA,\":\").concat(target.reserveB,\":\").concat(target.totalLiquidity);}export function lpKeyFromPositions(positions,poolCid){if(!positions||positions.length===0)return'';const filtered=poolCid?positions.filter(p=>p.poolCid===poolCid):positions;const sorted=[...filtered].sort((a,b)=>a.poolCid.localeCompare(b.poolCid));return sorted.map(pos=>{var _pos$shareBps;return\"\".concat(pos.poolCid,\":\").concat(pos.lpBalance,\":\").concat((_pos$shareBps=pos.shareBps)!==null&&_pos$shareBps!==void 0?_pos$shareBps:'');}).join('|');}export async function refreshLedgerState(_ref){let{label='ledger',maxWaitMs=DEFAULT_MAX_WAIT_MS,intervalMs=DEFAULT_INTERVAL_MS,getSnapshot,fetchSnapshot,onStatus}=_ref;const start=Date.now();const initial=getSnapshot();let attempt=0;while(true){attempt+=1;onStatus===null||onStatus===void 0?void 0:onStatus(\"Updating... (\".concat(label,\")\"));const next=await fetchSnapshot();if(!initial||!snapshotsEqual(initial,next)){onStatus===null||onStatus===void 0?void 0:onStatus(null);return;}if(Date.now()-start>=maxWaitMs){onStatus===null||onStatus===void 0?void 0:onStatus(null);return;}await sleep(intervalMs);}}function snapshotsEqual(a,b){if(!a||!b)return false;return normalizeSnapshot(a)===normalizeSnapshot(b);}function normalizeSnapshot(snapshot){var _snapshot$balancesKey,_snapshot$poolKey,_snapshot$lpKey;return JSON.stringify({balancesKey:(_snapshot$balancesKey=snapshot.balancesKey)!==null&&_snapshot$balancesKey!==void 0?_snapshot$balancesKey:'',poolKey:(_snapshot$poolKey=snapshot.poolKey)!==null&&_snapshot$poolKey!==void 0?_snapshot$poolKey:'',lpKey:(_snapshot$lpKey=snapshot.lpKey)!==null&&_snapshot$lpKey!==void 0?_snapshot$lpKey:''});}function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms));}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}