{"ast":null,"code":"import{useCallback,useEffect,useState}from\"react\";import{backendApi}from\"../services/backendApi\";const DEFAULT_DECIMALS=10;export function useUtxoBalances(partyId){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{ownerOnly=true,refreshIntervalMs=15000}=options;const[balances,setBalances]=useState({});const[loading,setLoading]=useState(false);const[isRefreshing,setIsRefreshing]=useState(false);const[error,setError]=useState(null);const hasBalances=Object.keys(balances).length>0;const fetchBalances=useCallback(async()=>{if(!partyId){setBalances({});setError(null);setLoading(false);setIsRefreshing(false);return;}setIsRefreshing(true);if(!hasBalances){setLoading(true);}try{const res=await backendApi.getHoldingUtxos(partyId,ownerOnly);const rows=Array.isArray(res)?res:Array.isArray(res===null||res===void 0?void 0:res.result)?res.result:[];const map=rows.reduce((acc,row)=>{var _ref,_ref2,_ref3,_ref4,_ref5,_row$instrumentAdmin,_row$instrument,_row$instrument2,_row$instrument_id,_row$instrumentId,_ref6,_ref7,_ref8,_ref9,_ref0,_ref1,_row$instrumentId2,_row$instrument3,_row$instrument4,_row$instrument4$inst,_row$instrument5,_row$instrument6,_row$instrument7,_ref10,_ref11,_ref12,_row$decimals,_row$instrument8,_row$instrument9,_ref13,_ref14,_ref15,_ref16,_row$amount,_existing$decimals;const instrumentAdmin=(_ref=(_ref2=(_ref3=(_ref4=(_ref5=(_row$instrumentAdmin=row===null||row===void 0?void 0:row.instrumentAdmin)!==null&&_row$instrumentAdmin!==void 0?_row$instrumentAdmin:row===null||row===void 0?void 0:row.instrument_admin)!==null&&_ref5!==void 0?_ref5:row===null||row===void 0?void 0:(_row$instrument=row.instrument)===null||_row$instrument===void 0?void 0:_row$instrument.admin)!==null&&_ref4!==void 0?_ref4:row===null||row===void 0?void 0:(_row$instrument2=row.instrument)===null||_row$instrument2===void 0?void 0:_row$instrument2.instrumentAdmin)!==null&&_ref3!==void 0?_ref3:row===null||row===void 0?void 0:(_row$instrument_id=row.instrument_id)===null||_row$instrument_id===void 0?void 0:_row$instrument_id.admin)!==null&&_ref2!==void 0?_ref2:row===null||row===void 0?void 0:(_row$instrumentId=row.instrumentId)===null||_row$instrumentId===void 0?void 0:_row$instrumentId.admin)!==null&&_ref!==void 0?_ref:\"\";const instrumentId=(_ref6=(_ref7=(_ref8=(_ref9=(_ref0=(_ref1=(_row$instrumentId2=row===null||row===void 0?void 0:row.instrumentId)!==null&&_row$instrumentId2!==void 0?_row$instrumentId2:row===null||row===void 0?void 0:row.instrument_id)!==null&&_ref1!==void 0?_ref1:row===null||row===void 0?void 0:(_row$instrument3=row.instrument)===null||_row$instrument3===void 0?void 0:_row$instrument3.id)!==null&&_ref0!==void 0?_ref0:row===null||row===void 0?void 0:(_row$instrument4=row.instrument)===null||_row$instrument4===void 0?void 0:(_row$instrument4$inst=_row$instrument4.instrumentId)===null||_row$instrument4$inst===void 0?void 0:_row$instrument4$inst.id)!==null&&_ref9!==void 0?_ref9:row===null||row===void 0?void 0:(_row$instrument5=row.instrument)===null||_row$instrument5===void 0?void 0:_row$instrument5.instrumentId)!==null&&_ref8!==void 0?_ref8:row===null||row===void 0?void 0:(_row$instrument6=row.instrument)===null||_row$instrument6===void 0?void 0:_row$instrument6.assetCode)!==null&&_ref7!==void 0?_ref7:row===null||row===void 0?void 0:(_row$instrument7=row.instrument)===null||_row$instrument7===void 0?void 0:_row$instrument7.symbol)!==null&&_ref6!==void 0?_ref6:\"\";if(!instrumentAdmin||!instrumentId){return acc;}const decimalsCandidate=(_ref10=(_ref11=(_ref12=(_row$decimals=row===null||row===void 0?void 0:row.decimals)!==null&&_row$decimals!==void 0?_row$decimals:row===null||row===void 0?void 0:row.precision)!==null&&_ref12!==void 0?_ref12:row===null||row===void 0?void 0:(_row$instrument8=row.instrument)===null||_row$instrument8===void 0?void 0:_row$instrument8.decimals)!==null&&_ref11!==void 0?_ref11:row===null||row===void 0?void 0:(_row$instrument9=row.instrument)===null||_row$instrument9===void 0?void 0:_row$instrument9.precision)!==null&&_ref10!==void 0?_ref10:DEFAULT_DECIMALS;const decimals=typeof decimalsCandidate===\"number\"&&Number.isFinite(decimalsCandidate)?decimalsCandidate:parseInt(String(decimalsCandidate),10)||DEFAULT_DECIMALS;const amountCandidate=(_ref13=(_ref14=(_ref15=(_ref16=(_row$amount=row===null||row===void 0?void 0:row.amount)!==null&&_row$amount!==void 0?_row$amount:row===null||row===void 0?void 0:row.quantity)!==null&&_ref16!==void 0?_ref16:row===null||row===void 0?void 0:row.balance)!==null&&_ref15!==void 0?_ref15:row===null||row===void 0?void 0:row.holdingAmount)!==null&&_ref14!==void 0?_ref14:row===null||row===void 0?void 0:row.value)!==null&&_ref13!==void 0?_ref13:\"0\";const amount=typeof amountCandidate===\"string\"?amountCandidate:String(amountCandidate!==null&&amountCandidate!==void 0?amountCandidate:\"0\");const key=\"\".concat(instrumentAdmin,\"::\").concat(instrumentId);const existing=acc[key];acc[key]={instrumentAdmin,instrumentId,decimals:(_existing$decimals=existing===null||existing===void 0?void 0:existing.decimals)!==null&&_existing$decimals!==void 0?_existing$decimals:decimals,amount:existing?decimalAddStrings(existing.amount,amount):amount};return acc;},{});setBalances(map);setError(null);}catch(err){console.warn(\"Failed to load UTXO balances for\",partyId,err);setError(err instanceof Error?err:new Error(\"Failed to load balances\"));}finally{setLoading(false);setIsRefreshing(false);}},[partyId,ownerOnly,hasBalances]);useEffect(()=>{fetchBalances();},[fetchBalances]);useEffect(()=>{if(!partyId||refreshIntervalMs<=0){return;}const interval=window.setInterval(()=>{fetchBalances();},refreshIntervalMs);return()=>{window.clearInterval(interval);};},[partyId,refreshIntervalMs,fetchBalances]);useEffect(()=>{if(typeof window===\"undefined\"){return;}const handleWalletConnected=()=>{fetchBalances();};window.addEventListener(\"clearportx:wallet:connected\",handleWalletConnected);return()=>{window.removeEventListener(\"clearportx:wallet:connected\",handleWalletConnected);};},[fetchBalances]);return{balances,loading,isRefreshing,error,reload:fetchBalances};}function decimalAddStrings(a,b){const sa=a!==null&&a!==void 0?a:\"0\";const sb=b!==null&&b!==void 0?b:\"0\";const[ia,fa=\"\"]=sa.split(\".\");const[ib,fb=\"\"]=sb.split(\".\");const fracLen=Math.max(fa.length,fb.length);const normFa=(fa+\"0\".repeat(fracLen)).slice(0,fracLen);const normFb=(fb+\"0\".repeat(fracLen)).slice(0,fracLen);const intA=BigInt(ia||\"0\");const intB=BigInt(ib||\"0\");const fracA=BigInt(normFa||\"0\");const fracB=BigInt(normFb||\"0\");const fracSum=fracA+fracB;const baseStr=\"1\"+\"0\".repeat(fracLen||0);const base=BigInt(baseStr);const carry=fracSum/base;const fracRes=fracSum%base;const intRes=intA+intB+carry;const fracStr=fracLen>0?fracRes.toString().padStart(fracLen,\"0\").replace(/0+$/,\"\"):\"\";return fracStr.length>0?\"\".concat(intRes.toString(),\".\").concat(fracStr):intRes.toString();}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}