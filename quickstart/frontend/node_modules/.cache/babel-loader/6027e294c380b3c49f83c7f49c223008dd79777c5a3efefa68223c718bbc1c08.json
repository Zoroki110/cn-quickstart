{"ast":null,"code":"import _objectSpread from\"/root/cn-quickstart/quickstart/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _BUILD_INFO$features;import{BUILD_INFO}from\"../config/build-info\";const runtimeBackendUrl=typeof window!==\"undefined\"?window.__BACKEND_URL__:undefined;const BASE_URL=process.env.REACT_APP_BACKEND_API_URL||(BUILD_INFO===null||BUILD_INFO===void 0?void 0:(_BUILD_INFO$features=BUILD_INFO.features)===null||_BUILD_INFO$features===void 0?void 0:_BUILD_INFO$features.backendUrl)||runtimeBackendUrl||\"http://localhost:8080\";const DEFAULT_HEADERS={\"Content-Type\":\"application/json\",\"ngrok-skip-browser-warning\":\"true\"};const WALLET_SESSION_KEY=\"clearportx.wallet.session\";let walletAuthToken=null;let activeWalletSession=null;let sessionHydrated=false;export function setAuthToken(token){walletAuthToken=token&&token.trim().length>0?token:null;}export function getAuthToken(){ensureSessionHydrated();return walletAuthToken;}export function persistWalletSession(session){var _session$token;sessionHydrated=true;activeWalletSession=session;walletAuthToken=(_session$token=session===null||session===void 0?void 0:session.token)!==null&&_session$token!==void 0?_session$token:null;if(typeof window===\"undefined\"){return;}if(!session){window.localStorage.removeItem(WALLET_SESSION_KEY);return;}try{window.localStorage.setItem(WALLET_SESSION_KEY,JSON.stringify(session));}catch(err){console.warn(\"Failed to persist wallet session\",err);}}export function loadWalletSession(){ensureSessionHydrated();return activeWalletSession;}export function clearWalletSession(){sessionHydrated=true;activeWalletSession=null;walletAuthToken=null;persistWalletSession(null);}export function getActiveWalletParty(){var _activeWalletSession$,_activeWalletSession;ensureSessionHydrated();return(_activeWalletSession$=(_activeWalletSession=activeWalletSession)===null||_activeWalletSession===void 0?void 0:_activeWalletSession.partyId)!==null&&_activeWalletSession$!==void 0?_activeWalletSession$:null;}export async function apiGet(path){return request(\"GET\",path);}export async function apiPostJson(path,body){return request(\"POST\",path,body);}async function request(method,path,body){const headers=_objectSpread({},DEFAULT_HEADERS);const token=getAuthToken();if(token){headers[\"Authorization\"]=\"Bearer \".concat(token);}const response=await fetch(\"\".concat(BASE_URL).concat(path),{method,headers,credentials:\"include\",body:body!==undefined?JSON.stringify(body):undefined});const payload=await parseJson(response);if(!response.ok){console.warn(\"[API] Non-2xx response\",response.url,response.status);const message=(payload===null||payload===void 0?void 0:payload.message)||(payload===null||payload===void 0?void 0:payload.error)||\"Request to \".concat(path,\" failed with status \").concat(response.status);throw new Error(message);}if(payload===null){console.warn(\"[API] Empty JSON response\",response.url);throw new Error(\"Request to \".concat(path,\" returned an empty response\"));}return payload;}async function parseJson(response){const contentType=response.headers.get(\"content-type\")||\"\";if(!contentType.includes(\"application/json\")){return null;}try{return await response.json();}catch(_unused){return null;}}function ensureSessionHydrated(){if(sessionHydrated||typeof window===\"undefined\"){return;}sessionHydrated=true;const stored=readSessionFromStorage();if(stored){activeWalletSession=stored;walletAuthToken=stored.token;}}function readSessionFromStorage(){const raw=window.localStorage.getItem(WALLET_SESSION_KEY);if(!raw){return null;}try{const parsed=JSON.parse(raw);if(parsed!==null&&parsed!==void 0&&parsed.token&&parsed!==null&&parsed!==void 0&&parsed.partyId){return parsed;}}catch(err){console.warn(\"Failed to parse wallet session\",err);}window.localStorage.removeItem(WALLET_SESSION_KEY);return null;}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}