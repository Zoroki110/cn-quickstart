{"ast":null,"code":"import _objectSpread from\"/root/cn-quickstart/quickstart/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/* Minimal vendored Zoro SDK based on provided docs and analyzed demo bundle. */export let SignRequestResponseType=/*#__PURE__*/function(SignRequestResponseType){SignRequestResponseType[\"SIGN_REQUEST_APPROVED\"]=\"sign_request_approved\";SignRequestResponseType[\"SIGN_REQUEST_REJECTED\"]=\"sign_request_rejected\";SignRequestResponseType[\"SIGN_REQUEST_ERROR\"]=\"sign_request_error\";return SignRequestResponseType;}({});class ZoroWallet{constructor(params){this.authToken=void 0;this.partyId=void 0;this.publicKey=void 0;this.apiUrl=void 0;this.ws=void 0;this.callbacks=void 0;this.authToken=params.authToken;this.partyId=params.partyId;this.publicKey=params.publicKey;this.apiUrl=params.apiUrl;this.ws=params.ws;this.callbacks=new Map();}getPartyId(){return this.partyId;}getPublicKey(){return this.publicKey;}async getHoldingUtxos(){const res=await fetch(\"\".concat(this.apiUrl,\"/api/v1/connect/wallet/holding-utxos\"),{method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(this.authToken)}});if(!res.ok){throw new Error(\"Failed to get holding utxos.\");}return res.json();}signMessage(message,cb){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){cb({type:SignRequestResponseType.SIGN_REQUEST_ERROR,data:{error:\"Not connected\"}});return;}const requestId=cryptoRandomId();this.callbacks.set(requestId,cb);const payload={requestId,type:\"sign_request\",data:{requestType:\"sign_raw_message\",payload:{message}}};this.ws.send(JSON.stringify(payload));}handleResponse(msg){const requestId=msg===null||msg===void 0?void 0:msg.requestId;if(!requestId||!this.callbacks.has(requestId))return;const cb=this.callbacks.get(requestId);const type=msg===null||msg===void 0?void 0:msg.type;if(type===SignRequestResponseType.SIGN_REQUEST_APPROVED){var _msg$data,_msg$data2;cb({type,data:{signature:msg===null||msg===void 0?void 0:(_msg$data=msg.data)===null||_msg$data===void 0?void 0:_msg$data.signature,updateId:msg===null||msg===void 0?void 0:(_msg$data2=msg.data)===null||_msg$data2===void 0?void 0:_msg$data2.updateId}});}else if(type===SignRequestResponseType.SIGN_REQUEST_REJECTED){var _msg$data3,_msg$data4;cb({type,data:{reason:msg===null||msg===void 0?void 0:(_msg$data3=msg.data)===null||_msg$data3===void 0?void 0:_msg$data3.reason,updateId:msg===null||msg===void 0?void 0:(_msg$data4=msg.data)===null||_msg$data4===void 0?void 0:_msg$data4.updateId}});}else if(type===SignRequestResponseType.SIGN_REQUEST_ERROR){var _msg$data5,_msg$data6;cb({type,data:{error:msg===null||msg===void 0?void 0:(_msg$data5=msg.data)===null||_msg$data5===void 0?void 0:_msg$data5.error,updateId:msg===null||msg===void 0?void 0:(_msg$data6=msg.data)===null||_msg$data6===void 0?void 0:_msg$data6.updateId}});}this.callbacks.delete(requestId);}disconnect(){this.callbacks.clear();try{var _this$ws;(_this$ws=this.ws)===null||_this$ws===void 0?void 0:_this$ws.close();}catch(_unused){/* ignore */}}}class ZoroSDK{constructor(){this.opts=null;this.initialized=false;this.ws=null;}init(opts){if(this.initialized)return;this.opts=opts;this.initialized=true;}async connect(){if(typeof window===\"undefined\"){throw new Error(\"ZoroSDK.connect() can only be called in a browser environment.\");}if(!this.initialized||!this.opts){throw new Error(\"SDK not initialized. Call init() first.\");}const stored=this.readStoredSession();if(stored&&stored.authToken&&stored.partyId&&stored.publicKey){var _this$opts$onAccept,_this$opts;const wallet=new ZoroWallet({authToken:stored.authToken,partyId:stored.partyId,publicKey:stored.publicKey,apiUrl:this.apiBase(),ws:null});(_this$opts$onAccept=(_this$opts=this.opts).onAccept)===null||_this$opts$onAccept===void 0?void 0:_this$opts$onAccept.call(_this$opts,wallet);return;}const sessionId=(stored===null||stored===void 0?void 0:stored.sessionId)||cryptoRandomId();const ticketId=await this.createTicket(sessionId);this.writeStoredSession({sessionId,ticketId});await this.openHandshake(ticketId);}async disconnect(){var _this$opts2,_this$opts2$onDisconn;this.clearStorage();try{var _this$ws2;(_this$ws2=this.ws)===null||_this$ws2===void 0?void 0:_this$ws2.close();}catch(_unused2){/* ignore */}this.ws=null;(_this$opts2=this.opts)===null||_this$opts2===void 0?void 0:(_this$opts2$onDisconn=_this$opts2.onDisconnect)===null||_this$opts2$onDisconn===void 0?void 0:_this$opts2$onDisconn.call(_this$opts2);}async createTicket(sessionId){var _this$opts3,_this$opts4;const apiBase=this.apiBase();const res=await fetch(\"\".concat(apiBase,\"/api/v1/connect/tickets\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({appName:(_this$opts3=this.opts)===null||_this$opts3===void 0?void 0:_this$opts3.appName,sessionId,iconUrl:(_this$opts4=this.opts)===null||_this$opts4===void 0?void 0:_this$opts4.iconUrl})});if(!res.ok){if(res.status===404){throw new Error(\"Zoro connect endpoint not found at \".concat(apiBase,\". Set REACT_APP_ZORO_API_URL / WALLET_URL to the environment provided by Zoro.\"));}throw new Error(\"Failed to get ticket from server.\");}const json=await res.json();if(!(json!==null&&json!==void 0&&json.ticketId)){throw new Error(\"TicketId missing in response.\");}return json.ticketId;}async openHandshake(ticketId){const wsUrl=this.wsUrl(ticketId);await new Promise((resolve,reject)=>{let resolved=false;const ws=new WebSocket(wsUrl);this.ws=ws;const onMessage=event=>{try{const msg=JSON.parse(event.data);if(msg.type===\"handshake_accept\"){const{authToken,partyId,publicKey}=msg.data||{};if(authToken&&partyId&&publicKey){var _this$opts5,_this$opts5$onAccept;this.writeStoredSession(_objectSpread(_objectSpread({},this.readStoredSession()||{}),{},{authToken,partyId,publicKey}));const wallet=new ZoroWallet({authToken,partyId,publicKey,apiUrl:this.apiBase(),ws});ws.onmessage=evt=>{try{const m=JSON.parse(evt.data);if(m.type===SignRequestResponseType.SIGN_REQUEST_APPROVED||m.type===SignRequestResponseType.SIGN_REQUEST_REJECTED||m.type===SignRequestResponseType.SIGN_REQUEST_ERROR){wallet.handleResponse(m);}}catch(_unused3){/* ignore */}};resolved=true;(_this$opts5=this.opts)===null||_this$opts5===void 0?void 0:(_this$opts5$onAccept=_this$opts5.onAccept)===null||_this$opts5$onAccept===void 0?void 0:_this$opts5$onAccept.call(_this$opts5,wallet);resolve();}}else if(msg.type===\"handshake_reject\"){var _this$opts6,_this$opts6$onReject;this.clearStorage();resolved=true;(_this$opts6=this.opts)===null||_this$opts6===void 0?void 0:(_this$opts6$onReject=_this$opts6.onReject)===null||_this$opts6$onReject===void 0?void 0:_this$opts6$onReject.call(_this$opts6);reject(new Error(\"Zoro connection rejected\"));}else if(msg.type===\"handshake_disconnect\"){var _this$opts7,_this$opts7$onDisconn;this.clearStorage();resolved=true;(_this$opts7=this.opts)===null||_this$opts7===void 0?void 0:(_this$opts7$onDisconn=_this$opts7.onDisconnect)===null||_this$opts7$onDisconn===void 0?void 0:_this$opts7$onDisconn.call(_this$opts7);reject(new Error(\"Zoro connection disconnected\"));}}catch(_unused4){/* ignore */}};const onError=err=>{if(!resolved){reject(err instanceof Error?err:new Error(\"Zoro websocket error\"));}};const onClose=()=>{if(!resolved){reject(new Error(\"Zoro websocket closed\"));}};ws.addEventListener(\"message\",onMessage);ws.addEventListener(\"error\",onError);ws.addEventListener(\"close\",onClose);});}apiBase(){var _this$opts8,_this$opts9;if((_this$opts8=this.opts)!==null&&_this$opts8!==void 0&&_this$opts8.apiUrl)return this.opts.apiUrl;if(((_this$opts9=this.opts)===null||_this$opts9===void 0?void 0:_this$opts9.network)===\"local\")return\"http://localhost:3001\";return\"https://api.zorowallet.com\";}wsUrl(ticketId){const api=this.apiBase();const url=new URL(api);const protocol=url.protocol===\"http:\"?\"ws:\":\"wss:\";const host=url.host;return\"\".concat(protocol,\"//\").concat(host,\"/connect/ws?ticketId=\").concat(ticketId);}readStoredSession(){if(typeof window===\"undefined\")return null;const raw=window.localStorage.getItem(\"zoro_connect\");if(!raw)return null;try{return JSON.parse(raw);}catch(_unused5){return null;}}writeStoredSession(value){if(typeof window===\"undefined\")return;try{window.localStorage.setItem(\"zoro_connect\",JSON.stringify(value));}catch(_unused6){/* ignore */}}clearStorage(){if(typeof window===\"undefined\")return;try{window.localStorage.removeItem(\"zoro_connect\");}catch(_unused7){/* ignore */}}}export const zoro=new ZoroSDK();function cryptoRandomId(){const cryptoObj=typeof window!==\"undefined\"?window.crypto||window.msCrypto||undefined:undefined;if(cryptoObj&&typeof cryptoObj.randomUUID===\"function\"){return cryptoObj.randomUUID();}const bytes=new Uint8Array(16);if(cryptoObj&&typeof cryptoObj.getRandomValues===\"function\"){cryptoObj.getRandomValues(bytes);}else{for(let i=0;i<16;i++)bytes[i]=Math.floor(Math.random()*256);}const hex=Array.from(bytes,b=>b.toString(16).padStart(2,\"0\")).join(\"\");return[hex.substring(0,8),hex.substring(8,12),hex.substring(12,16),hex.substring(16,20),hex.substring(20,32)].join(\"-\");}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}