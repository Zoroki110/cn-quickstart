{"ast":null,"code":"export class LoopWalletConnector{constructor(){this.loopApi=null;this.provider=null;this.initPromise=void 0;this.connectWaiters=[];}async connect(){await this.ensureInitialized();if(this.provider)return;const api=this.loopApi;const connectFn=api===null||api===void 0?void 0:api.connect;if(!api||typeof connectFn!==\"function\"){throw new Error(\"Loop SDK connect() is not available.\");}if(LoopWalletConnector.DEBUG)console.debug(\"[Loop] connect start\");await new Promise((resolve,reject)=>{const timeout=setTimeout(()=>{reject(new Error(\"Loop connect timeout\"));},120000);this.connectWaiters.push({resolve:p=>{clearTimeout(timeout);if(!p){reject(new Error(\"Loop provider not returned\"));}else{resolve();}},reject:err=>{clearTimeout(timeout);reject(err);}});try{const res=connectFn();if(res&&typeof res.then===\"function\"){res.then(maybeProvider=>{if(maybeProvider&&typeof maybeProvider===\"object\"){this.provider=maybeProvider;this.connectWaiters.forEach(p=>p.resolve(this.provider));this.connectWaiters=[];}}).catch(err=>{clearTimeout(timeout);reject(err);});}else if(res&&typeof res===\"object\"){this.provider=res;this.connectWaiters.forEach(p=>p.resolve(this.provider));this.connectWaiters=[];clearTimeout(timeout);resolve();return;}if(res&&typeof res.catch===\"function\"){res.catch(err=>{clearTimeout(timeout);reject(err);});}}catch(err){clearTimeout(timeout);reject(err);}});}async getParty(){var _ref,_ref2,_ref3,_prov$party_id,_prov$connection,_prov$connection2;await this.ensureConnected();const prov=this.provider;const party=(_ref=(_ref2=(_ref3=(_prov$party_id=prov===null||prov===void 0?void 0:prov.party_id)!==null&&_prov$party_id!==void 0?_prov$party_id:prov===null||prov===void 0?void 0:prov.partyId)!==null&&_ref3!==void 0?_ref3:prov===null||prov===void 0?void 0:prov.party)!==null&&_ref2!==void 0?_ref2:prov===null||prov===void 0?void 0:(_prov$connection=prov.connection)===null||_prov$connection===void 0?void 0:_prov$connection.partyId)!==null&&_ref!==void 0?_ref:prov===null||prov===void 0?void 0:(_prov$connection2=prov.connection)===null||_prov$connection2===void 0?void 0:_prov$connection2.party;if(!party){if(LoopWalletConnector.DEBUG)console.debug(\"[Loop] provider missing partyId\",prov);throw new Error(\"Loop connect succeeded but partyId is missing (provider.connection undefined). Check popup blocked or SDK API mismatch.\");}return party;}async signMessage(message){var _this$provider;await this.ensureConnected();const signer=(_this$provider=this.provider)===null||_this$provider===void 0?void 0:_this$provider.signMessage;if(!signer){throw new Error(\"Loop wallet does not expose signMessage()\");}const signature=await signer(message);if(!signature){throw new Error(\"Loop wallet returned an empty signature\");}return signature;}getProvider(){return this.provider;}getType(){return\"loop\";}async ensureConnected(){await this.ensureInitialized();if(this.provider)return;await this.connect();if(!this.provider){console.warn(\"Loop provider missing after connect()\");throw new Error(\"Loop wallet did not provide a provider after connect()\");}}async ensureInitialized(){if(this.initPromise){return this.initPromise;}this.initPromise=this.loadAndInitSdk();return this.initPromise;}async loadAndInitSdk(){var _ref4,_ref5,_loop;const sdkModule=await import(\"@fivenorth/loop-sdk\");const loopApi=(_ref4=(_ref5=(_loop=sdkModule.loop)!==null&&_loop!==void 0?_loop:sdkModule.Loop)!==null&&_ref5!==void 0?_ref5:sdkModule.default)!==null&&_ref4!==void 0?_ref4:sdkModule;this.loopApi=loopApi;if(!loopApi||typeof loopApi.init!==\"function\"||typeof loopApi.connect!==\"function\"){throw new Error(\"Loop SDK is unavailable (missing init/connect)\");}const capture=provider=>{this.provider=provider;this.connectWaiters.forEach(p=>p.resolve(provider));this.connectWaiters=[];if(LoopWalletConnector.DEBUG)console.debug(\"[Loop] onAccept provider\",provider);};loopApi.init({appName:\"ClearportX\",network:\"devnet\",options:{openMode:\"popup\",requestSigningMode:\"popup\"},onAccept:capture,onReject:()=>{this.provider=null;this.connectWaiters.forEach(p=>p.reject(new Error(\"Loop connection rejected by user\")));this.connectWaiters=[];if(LoopWalletConnector.DEBUG)console.debug(\"[Loop] onReject\");}});}}// Netlify redeploy marker: do not remove. This forces a fresh build.\nLoopWalletConnector.DEBUG=false;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}