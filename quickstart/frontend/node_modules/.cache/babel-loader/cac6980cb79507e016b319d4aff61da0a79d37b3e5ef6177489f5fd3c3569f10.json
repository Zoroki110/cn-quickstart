{"ast":null,"code":"import React,{useCallback,useEffect}from'react';import{useAppStore}from'../stores';import{backendApi}from'../services/backendApi';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PoolsInterface=()=>{var _pools$;const{pools,setPools}=useAppStore();const navigate=useNavigate();const[loading,setLoading]=React.useState(true);const[volumeByPool,setVolumeByPool]=React.useState({});const[totalVolume24h,setTotalVolume24h]=React.useState(0);const[volumeDay,setVolumeDay]=React.useState(()=>new Date().toISOString().slice(0,10));useEffect(()=>{const loadPools=async()=>{try{setLoading(true);const poolsData=await backendApi.getPools();setPools(poolsData);}catch(error){console.error('Error loading pools:',error);}finally{setLoading(false);}};loadPools();},[setPools]);// Calculer les statistiques globales\nconst totalTVL=pools.reduce((sum,pool)=>{// Approximation: TVL = reserveA + reserveB (en assumant que les tokens ont des valeurs similaires)\nreturn sum+pool.reserveA+pool.reserveB;},0);const effectiveTotalVolume24h=totalVolume24h;const averageAPR=pools.length>0?pools.reduce((sum,pool)=>sum+pool.apr,0)/pools.length:0;const renderPoolToken=function(token){let extraClasses=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';return/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 rounded-full overflow-hidden border border-white/50 shadow-md flex items-center justify-center \".concat(token.logoUrl?'bg-white dark:bg-dark-700':'bg-primary-50 dark:bg-dark-800',\" \").concat(extraClasses),children:token.logoUrl?/*#__PURE__*/_jsx(\"img\",{src:token.logoUrl,alt:\"\".concat(token.symbol,\" logo\"),className:\"w-full h-full object-cover\",loading:\"lazy\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-base font-bold text-gray-900 dark:text-gray-100\",children:token.symbol.charAt(0)})});};const formatNumber=num=>{if(num>=1000000){return\"$\".concat((num/1000000).toFixed(2),\"M\");}else if(num>=1000){return\"$\".concat((num/1000).toFixed(2),\"K\");}return\"$\".concat(num.toFixed(2));};const formatTokenCompact=amount=>{if(!Number.isFinite(amount)){return'0';}if(amount>=1000000){return\"\".concat((amount/1000000).toFixed(2),\"M\");}if(amount>=1000){return\"\".concat((amount/1000).toFixed(2),\"K\");}if(amount>=1){return amount.toFixed(2);}return amount.toFixed(6).replace(/0+$/,'').replace(/\\.$/,'');};const computeVolumeSnapshot=useCallback(entries=>{const dayKey=new Date().toISOString().slice(0,10);const byPool={};let total=0;entries.forEach(entry=>{if(entry.type!=='SWAP')return;if(!entry.createdAt)return;const entryDay=new Date(entry.createdAt).toISOString().slice(0,10);if(entryDay!==dayKey)return;const amountIn=Number(entry.amountADesired);if(!Number.isFinite(amountIn))return;total+=amountIn;const poolKey=entry.poolId||entry.contractId;if(poolKey){var _byPool$poolKey;byPool[poolKey]=((_byPool$poolKey=byPool[poolKey])!==null&&_byPool$poolKey!==void 0?_byPool$poolKey:0)+amountIn;}});setVolumeByPool(byPool);setTotalVolume24h(total);setVolumeDay(dayKey);},[]);const refreshVolumes=useCallback(async()=>{try{const entries=await backendApi.getTransactionHistory();computeVolumeSnapshot(entries);}catch(error){console.warn('Failed to load transaction history for volume:',error);}},[computeVolumeSnapshot]);useEffect(()=>{refreshVolumes();},[refreshVolumes]);useEffect(()=>{const interval=window.setInterval(()=>{const dayKey=new Date().toISOString().slice(0,10);if(dayKey!==volumeDay){refreshVolumes();}},60000);return()=>window.clearInterval(interval);},[refreshVolumes,volumeDay]);if(loading){return/*#__PURE__*/_jsxs(\"section\",{className:\"relative min-h-[calc(100vh-220px)] flex items-center justify-center px-4 py-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pointer-events-none absolute inset-0 bg-gradient-to-b from-white/0 via-white/70 to-white dark:from-dark-900/0 dark:via-dark-900/60 dark:to-dark-950\",\"aria-hidden\":\"true\"}),/*#__PURE__*/_jsx(\"div\",{className:\"relative w-full max-w-6xl\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner w-12 h-12\"})})})})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-[calc(100vh-220px)] px-4 py-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative max-w-6xl mx-auto space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"glass-strong rounded-2xl p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"heading-2\",children:\"Liquidity Pools\"}),/*#__PURE__*/_jsx(\"p\",{className:\"body-small mt-1\",children:\"Provide liquidity and earn trading fees\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/liquidity'),className:\"btn-primary px-6 py-3\",children:\"+ Add Liquidity\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"glass-subtle rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Total Value Locked\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-gradient\",children:formatNumber(totalTVL)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 rounded-xl bg-primary-100 dark:bg-primary-900/20 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-primary-600 dark:text-primary-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"})})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"glass-subtle rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"24h Volume\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-gradient-cleaportx\",children:formatTokenCompact(effectiveTotalVolume24h)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 rounded-xl bg-success-100 dark:bg-success-900/20 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-success-600 dark:text-success-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z\"})})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"glass-subtle rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Average APR\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold text-success-600 dark:text-success-400\",children:[averageAPR.toFixed(2),\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 rounded-xl bg-warning-100 dark:bg-warning-900/20 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-warning-600 dark:text-warning-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\"})})})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between\",children:/*#__PURE__*/_jsxs(\"h2\",{className:\"heading-3\",children:[\"All Pools (\",pools.length,\")\"]})}),pools.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"card text-center py-12\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400\",children:\"No pools available yet. Be the first to create a pool!\"})}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 gap-4\",children:pools.map(pool=>{var _volumeByPool$pool$co,_volumeByPool$pool$co2,_pool$userShare;return/*#__PURE__*/_jsxs(\"div\",{className:\"card-hover glass-strong rounded-2xl p-6 transition-all duration-300\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[renderPoolToken(pool.tokenA),renderPoolToken(pool.tokenB,'-ml-3'),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"font-bold text-lg text-gray-900 dark:text-gray-100\",children:[pool.tokenA.symbol,\"/\",pool.tokenB.symbol]}),/*#__PURE__*/_jsxs(\"p\",{className:\"body-small\",children:[pool.tokenA.name,\" / \",pool.tokenB.name]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"hidden lg:flex items-center space-x-8 ml-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Liquidity\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-gray-900 dark:text-gray-100\",children:[formatTokenCompact(pool.reserveA),\" \",pool.tokenA.symbol]}),/*#__PURE__*/_jsxs(\"p\",{className:\"body-small text-gray-500\",children:[formatTokenCompact(pool.reserveB),\" \",pool.tokenB.symbol]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"APR\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold text-success-600 dark:text-success-400\",children:[pool.apr.toFixed(2),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"24h Volume\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold text-gray-900 dark:text-gray-100\",children:formatTokenCompact((_volumeByPool$pool$co=volumeByPool[pool.contractId])!==null&&_volumeByPool$pool$co!==void 0?_volumeByPool$pool$co:pool.volume24h)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Fee\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-gray-900 dark:text-gray-100\",children:[(pool.feeRate*100).toFixed(2),\"%\"]})]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/liquidity',{state:{pool}}),className:\"btn-primary ml-4\",children:\"Add Liquidity\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:hidden mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Liquidity\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-sm text-gray-900 dark:text-gray-100\",children:[formatTokenCompact(pool.reserveA),\" \",pool.tokenA.symbol]}),/*#__PURE__*/_jsxs(\"p\",{className:\"body-small text-gray-500\",children:[formatTokenCompact(pool.reserveB),\" \",pool.tokenB.symbol]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"APR\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold text-success-600 dark:text-success-400\",children:[pool.apr.toFixed(2),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"24h Volume\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold text-sm text-gray-900 dark:text-gray-100\",children:formatTokenCompact((_volumeByPool$pool$co2=volumeByPool[pool.contractId])!==null&&_volumeByPool$pool$co2!==void 0?_volumeByPool$pool$co2:pool.volume24h)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Fee\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-sm text-gray-900 dark:text-gray-100\",children:[(pool.feeRate*100).toFixed(2),\"%\"]})]})]})}),pool.userLiquidity&&pool.userLiquidity>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Your Position\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-gray-900 dark:text-gray-100\",children:[pool.userLiquidity.toFixed(4),\" LP Tokens\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"body-small mb-1\",children:\"Pool Share\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold text-primary-600 dark:text-primary-400\",children:[(_pool$userShare=pool.userShare)===null||_pool$userShare===void 0?void 0:_pool$userShare.toFixed(2),\"%\"]})]})]})})]},pool.contractId);})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"glass-subtle rounded-2xl p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2 text-gray-900 dark:text-gray-100\",children:\"About Liquidity Pools\"}),/*#__PURE__*/_jsx(\"p\",{className:\"body-small\",children:\"Liquidity pools allow you to earn fees by providing liquidity to trading pairs. When you add liquidity, you receive LP (Liquidity Provider) tokens that represent your share of the pool. You earn a portion of trading fees proportional to your share.\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"mt-2 space-y-1 body-small text-gray-600 dark:text-gray-400\",children:[/*#__PURE__*/_jsxs(\"li\",{children:[\"\\u2022 Earn \",((((_pools$=pools[0])===null||_pools$===void 0?void 0:_pools$.feeRate)||0.003)*100).toFixed(2),\"% fee from every trade\"]}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Your share of fees increases with your pool share\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Withdraw your liquidity anytime by burning LP tokens\"})]})]})]})})]})});};export default PoolsInterface;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}