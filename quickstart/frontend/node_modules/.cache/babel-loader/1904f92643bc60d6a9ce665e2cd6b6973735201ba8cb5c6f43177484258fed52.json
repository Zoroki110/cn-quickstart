{"ast":null,"code":"import{useCallback,useEffect,useState}from\"react\";import{walletManager}from\"../wallet\";export function useHoldingUtxos(params){const{walletType}=params;const[utxos,setUtxos]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[debugged,setDebugged]=useState(false);const load=useCallback(async()=>{if(walletType!==\"loop\"){setUtxos([]);setError(null);setLoading(false);return;}const connector=walletManager.getLoopConnector();if(!connector||typeof connector.getActiveContracts!==\"function\"){setUtxos([]);setError(new Error(\"Loop connector not ready for UTXO fetch\"));setLoading(false);return;}setLoading(true);setError(null);try{const contracts=await connector.getActiveContracts({interfaceId:\"#splice-api-token-holding-v1:Splice.Api.Token.HoldingV1:Holding\"});const mapped=Array.isArray(contracts)?contracts.map(normalizeUtxo).filter(Boolean):[];setUtxos(mapped);if(!debugged){console.debug(\"Loop UTXOs (Holding):\",mapped);setDebugged(true);}}catch(err){setUtxos([]);setError(err instanceof Error?err:new Error(\"Failed to load UTXOs\"));}finally{setLoading(false);}},[walletType,debugged]);useEffect(()=>{load();},[load]);return{utxos,loading,error,refresh:load};}function normalizeUtxo(raw){var _ref,_ref2,_ref3,_raw$contractId,_ref4,_ref5,_ref6,_raw$payload,_ref7,_ref8,_payload$instrumentId,_ref9,_ref0,_ref1,_instrument$id,_instrument$instrumen,_ref10,_ref11,_ref12,_payload$amount,_ref13,_payload$decimals,_ref14,_payload$owner,_ref15,_payload$observers;const cid=(_ref=(_ref2=(_ref3=(_raw$contractId=raw===null||raw===void 0?void 0:raw.contractId)!==null&&_raw$contractId!==void 0?_raw$contractId:raw===null||raw===void 0?void 0:raw.contract_id)!==null&&_ref3!==void 0?_ref3:raw===null||raw===void 0?void 0:raw.cid)!==null&&_ref2!==void 0?_ref2:raw===null||raw===void 0?void 0:raw.id)!==null&&_ref!==void 0?_ref:\"\";if(!cid)return null;const payload=(_ref4=(_ref5=(_ref6=(_raw$payload=raw===null||raw===void 0?void 0:raw.payload)!==null&&_raw$payload!==void 0?_raw$payload:raw===null||raw===void 0?void 0:raw.fields)!==null&&_ref6!==void 0?_ref6:raw===null||raw===void 0?void 0:raw.arguments)!==null&&_ref5!==void 0?_ref5:raw===null||raw===void 0?void 0:raw.data)!==null&&_ref4!==void 0?_ref4:raw;const instrument=(_ref7=(_ref8=(_payload$instrumentId=payload===null||payload===void 0?void 0:payload.instrumentId)!==null&&_payload$instrumentId!==void 0?_payload$instrumentId:payload===null||payload===void 0?void 0:payload.instrument_id)!==null&&_ref8!==void 0?_ref8:payload===null||payload===void 0?void 0:payload.instrument)!==null&&_ref7!==void 0?_ref7:{};const instrumentId=(_ref9=(_ref0=(_ref1=(_instrument$id=instrument===null||instrument===void 0?void 0:instrument.id)!==null&&_instrument$id!==void 0?_instrument$id:instrument===null||instrument===void 0?void 0:(_instrument$instrumen=instrument.instrumentId)===null||_instrument$instrumen===void 0?void 0:_instrument$instrumen.id)!==null&&_ref1!==void 0?_ref1:instrument===null||instrument===void 0?void 0:instrument.assetCode)!==null&&_ref0!==void 0?_ref0:instrument===null||instrument===void 0?void 0:instrument.symbol)!==null&&_ref9!==void 0?_ref9:\"UNKNOWN\";const amountCandidate=(_ref10=(_ref11=(_ref12=(_payload$amount=payload===null||payload===void 0?void 0:payload.amount)!==null&&_payload$amount!==void 0?_payload$amount:payload===null||payload===void 0?void 0:payload.quantity)!==null&&_ref12!==void 0?_ref12:payload===null||payload===void 0?void 0:payload.balance)!==null&&_ref11!==void 0?_ref11:payload===null||payload===void 0?void 0:payload.holdingAmount)!==null&&_ref10!==void 0?_ref10:\"0\";const amount=typeof amountCandidate===\"string\"?amountCandidate:String(amountCandidate!==null&&amountCandidate!==void 0?amountCandidate:\"0\");const decimalsCandidate=(_ref13=(_payload$decimals=payload===null||payload===void 0?void 0:payload.decimals)!==null&&_payload$decimals!==void 0?_payload$decimals:payload===null||payload===void 0?void 0:payload.precision)!==null&&_ref13!==void 0?_ref13:10;const decimals=typeof decimalsCandidate===\"number\"&&Number.isFinite(decimalsCandidate)?decimalsCandidate:parseInt(String(decimalsCandidate),10)||10;const owner=(_ref14=(_payload$owner=payload===null||payload===void 0?void 0:payload.owner)!==null&&_payload$owner!==void 0?_payload$owner:payload===null||payload===void 0?void 0:payload.party)!==null&&_ref14!==void 0?_ref14:payload===null||payload===void 0?void 0:payload.holder;const observers=(_ref15=(_payload$observers=payload===null||payload===void 0?void 0:payload.observers)!==null&&_payload$observers!==void 0?_payload$observers:payload===null||payload===void 0?void 0:payload.witnesses)!==null&&_ref15!==void 0?_ref15:undefined;return{contractId:cid,instrumentId:instrumentId,amount,decimals,owner,observers:Array.isArray(observers)?observers:undefined,raw};}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}