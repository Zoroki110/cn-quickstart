{"ast":null,"code":"var _process$env$REACT_AP,_process$env$REACT_AP2,_process$env$REACT_AP3,_process$env$REACT_AP4;// OAuth Authentication Service for Canton Network DevNet\n// Using Keycloak-js with PKCE flow (Authorization Code + PKCE)\nimport Keycloak from\"keycloak-js\";const AUTH_ENABLED=((_process$env$REACT_AP=process.env.REACT_APP_AUTH_ENABLED)!==null&&_process$env$REACT_AP!==void 0?_process$env$REACT_AP:\"false\")===\"true\";const keycloak=new Keycloak({url:(_process$env$REACT_AP2=process.env.REACT_APP_OAUTH_BASE_URL)!==null&&_process$env$REACT_AP2!==void 0?_process$env$REACT_AP2:\"https://auth.canton.network\",realm:(_process$env$REACT_AP3=process.env.REACT_APP_OAUTH_REALM)!==null&&_process$env$REACT_AP3!==void 0?_process$env$REACT_AP3:\"AppProvider\",clientId:(_process$env$REACT_AP4=process.env.REACT_APP_OAUTH_CLIENT_ID)!==null&&_process$env$REACT_AP4!==void 0?_process$env$REACT_AP4:\"clearportx-web\"});let initialized=false;/**\n * Initialize Keycloak authentication\n * Should be called once at app startup\n */export async function initAuth(){if(!AUTH_ENABLED||initialized){console.log('[Auth] Authentication disabled or already initialized');return;}try{var _process$env$REACT_AP5;initialized=true;const authenticated=await keycloak.init({onLoad:\"check-sso\",pkceMethod:\"S256\",checkLoginIframe:false,redirectUri:(_process$env$REACT_AP5=process.env.REACT_APP_OAUTH_REDIRECT_URI)!==null&&_process$env$REACT_AP5!==void 0?_process$env$REACT_AP5:window.location.origin+\"/auth/callback\",silentCheckSsoRedirectUri:\"\".concat(window.location.origin,\"/silent-check-sso.html\")});console.log('[Auth] Keycloak initialized. Authenticated:',authenticated);// Auto-refresh token every 30 seconds\nsetInterval(async()=>{if(keycloak.authenticated){try{const refreshed=await keycloak.updateToken(60);if(refreshed){console.log('[Auth] Token refreshed');}}catch(error){console.warn('[Auth] Failed to refresh token:',error);}}},30000);}catch(error){console.error('[Auth] Failed to initialize Keycloak:',error);throw error;}}/**\n * Check if user is authenticated\n */export function isAuthenticated(){return AUTH_ENABLED?!!keycloak.authenticated:true;}/**\n * Initiate login flow\n */export function login(){var _process$env$REACT_AP6;if(!AUTH_ENABLED){console.log('[Auth] Authentication disabled, skipping login');return;}const redirectUri=(_process$env$REACT_AP6=process.env.REACT_APP_OAUTH_REDIRECT_URI)!==null&&_process$env$REACT_AP6!==void 0?_process$env$REACT_AP6:window.location.origin+\"/auth/callback\";console.log('[Auth] Initiating login with redirect:',redirectUri);keycloak.login({redirectUri});}/**\n * Logout user\n */export function logout(){if(!AUTH_ENABLED){console.log('[Auth] Authentication disabled, skipping logout');return;}console.log('[Auth] Logging out');keycloak.logout({redirectUri:window.location.origin});}/**\n * Get current access token (JWT)\n */export function getAccessToken(){var _keycloak$token;if(!AUTH_ENABLED){// Return mock token for development\nreturn\"devnet-mock-token\";}return(_keycloak$token=keycloak.token)!==null&&_keycloak$token!==void 0?_keycloak$token:null;}/**\n * Get username from token\n */export function getUsername(){var _ref,_tokenParsed$preferre;if(!AUTH_ENABLED){return\"devnet-user\";}const tokenParsed=keycloak.tokenParsed;return(_ref=(_tokenParsed$preferre=tokenParsed===null||tokenParsed===void 0?void 0:tokenParsed.preferred_username)!==null&&_tokenParsed$preferre!==void 0?_tokenParsed$preferre:tokenParsed===null||tokenParsed===void 0?void 0:tokenParsed.email)!==null&&_ref!==void 0?_ref:null;}/**\n * Get user's party ID from token (if available)\n */export function getPartyId(){var _ref2,_tokenParsed$party;if(!AUTH_ENABLED){return null;}const tokenParsed=keycloak.tokenParsed;// Check for custom party claim (you may need to adjust this based on your Keycloak setup)\nreturn(_ref2=(_tokenParsed$party=tokenParsed===null||tokenParsed===void 0?void 0:tokenParsed.party)!==null&&_tokenParsed$party!==void 0?_tokenParsed$party:tokenParsed===null||tokenParsed===void 0?void 0:tokenParsed.sub)!==null&&_ref2!==void 0?_ref2:null;}/**\n * Get full token payload (for debugging)\n */export function getTokenPayload(){var _ref3;if(!AUTH_ENABLED){return{mock:true,username:\"devnet-user\"};}return(_ref3=keycloak.tokenParsed)!==null&&_ref3!==void 0?_ref3:null;}// Export raw keycloak instance for advanced usage\nexport{keycloak};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}